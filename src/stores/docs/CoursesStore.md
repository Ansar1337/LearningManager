### Документация к `CoursesStore`

`useCoursesStore` - это хранилище состояний для управления сессиями пользователя в приложении Vue.js с использованием
библиотеки `Pinia`.

#### Экспортирует 4 свойства:

1. `availableCourses` - список курсов, доступных на сервисе;
   ##### Структура состояния
   ```json
    {
      "id": "INT // идентификатор курса",
      "title": "STRING // наименование курса",
      "description": "STRING // краткое описание курса",
      "icon": "URL // путь к иконке курса",
      "bigIcon": "URL, // Путь к хайрез иконке курса",   
      "details": {
        "dateStart": "DateSTRING // дата начала курса",
        "dateEnd": "DateSTRING // дата конца курса",
        "timeEstimation": "BIGINT // примерная длительность обучения в мс",
        "modules": "STRING[] // список **названий** модулей, входящих в курс",
        "longDescription": "STRING // полное описание курса"
      }
    }
   ```
   ##### Особенности
    - Загружается и обновляется автоматически;
        - Учитывайте, что до загрузки свойства могут быть равны undefined или null;
        - Обращайтесь ко вложенным свойствам через `?.`, `val?.[index]?.attr`;
    - Для оптимизации трафика поле `details` не будет загружено до первого обращения к нему;
    - При обращении к веткам объекта из кода в <script>, учитывайте его асинхронную природу;
        - Как пример, `availableCourses[n].details.modules[m]` будет работать только если ветка гарантированно
          прогружена!
        - `availableCourses[n].details.modules[m].then(action)` будет работать в любом случае;
        - внутри <template> `availableCourses[n].details.modules[m]` будет работать в "синхронной манере" всегда;

2. `userCourses` - список курсов, на которые подписан пользователь;
   ##### Структура состояния
    ```json
    {
      "id": "INT // идентификатор курса",
      "completeness": "INT // приблизительный статус завершенности в процентах",
      "modules": [
        {
          "name": "STRING // наименование модуля",
          "lessonsCompleted": "INT // количество завершенных уроков",
          "lessonsTotal": "INT // общее количество уроков",
          "deadline": "DateSTRING // время завершения модуля",
          "estimatedTime": "BIGINT // примерная длительность модуля в мс",
          "performance": "INT // текущая успеваемость студента от 0 до 100",
          "resources": {
            "articles": [
              {
                "id": "INT // Идентификатор группы тем или статьи",
                "name": "STRING // Название группы тем или статьи",
                "type": "STRING // Тип элемента: `group` для групп тем, `article` для статей",
                "completed": "WRITABLE BOOLEAN // Статус завершения: true или false",
                "content": "ArticleTreeNodes[] // Для групп тем содержит массив статей или подгрупп"
              }
            ],
            "homework": {
              "task": "STRING // HTML с текстом задания и подсказками",
              "submissions": [
                {
                  "date": "STRING // Дата и время отправки задания",
                  "fileName": "STRING // Имя файла с решением",
                  "hash": "STRING // Хеш файла для скачивания",
                  "status": "STRING // Статус проверки задания ('Accepted', 'Pending', 'Rejected')"
                }             
              ],
              "tools": {
                  "addComment": "Метод для обновления комментария от лица активного пользователя",
                  "uploadHomework": "Метод для выгрузки домашней работы на сервер",
                  "downloadHomework": "Метод для скачивания домашней работы с сервера на клиент"
                },
              "status": "STRING // Статус выполнения задания ('Done', 'In progress')",
              "score": "INT // Оценка за задание (0-100)",
              "comments": [
                {
                  "sender": "INT // ID отправителя комментария, 0 для системных сообщений",
                  "dateTime": "STRING // Дата и время комментария",
                  "message": "STRING // Текст комментария",
                  "unread": "WRITABLE BOOLEAN // статус прочитанности сообщения"
                }
              ]
            },
            "test": {
               "questionsCount": "INT // Количество вопросов в тесте",
               "currentTry": "INT // Номер текущей попытки прохождения",
               "state": "STRING // Состояние теста ('in_progress', 'idle')",
               "lastQuestion": "INT // Номер последнего отвеченного вопроса",
               "triesLimit": "INT // Лимит попыток прохождения",
               "mistakesLimit": "INT // Допустимое количество ошибок",
               "lastAttemptTime": "BIGINT // Время последней попытки в формате Unix Timestamp",
               "questions": [
                {
                  "title": "STRING // Текст вопроса",
                  "type": "STRING // Тип вопроса ('single' для одного ответа, 'many' для нескольких)",
                  "options": {
                    "Текст варианта ответа": "WRITABLE BOOLEAN // Выбран ли данный вариант ответа"
                  }
                }
               ],
               "review": {
                "score": "INT // Итоговая оценка за тест",
                "passed": "BOOLEAN // Пройден тест или нет",
                "mistakes": "INT // Количество допущенных ошибок",
                "structure": "BOOLEAN[] // Массив с результатами ответов на вопросы (true - правильно, false - неправильно)"
               },
               "tools": {
                  "updateMeta": "Метод для обновления метаданных теста. Ожидается, что она обновит текущее состояние теста, количество попыток и другие метаданные.",
                  "launch": "Метод для начала прохождения теста. Переводит состояние теста в 'in_progress', обновляет состояние вопросов.",
                  "finish": "Метод для завершения текущей попытки прохождения теста. Фиксирует время попытки, обновляет состояние теста на 'idle', инкрементирует счетчик попыток, обновляет оценку и структуру ответов на вопросы."
               }
            }
          }
        }
      ]
   }
   ```
   #### Методы
    - `userCourses.modules[n].resources.homework.tools`:
        - `addComment(message)`: Асинхронно добавляет текстовый комментарий к домашнему заданию, автоматически обновляет
          список комментариев в хранилище;
        - `uploadHomework(file)`: Асинхронно выгружает файл на сервер. Обратите внимание, переданный параметр должен
          иметь тип file, такой можно получить из `<input type=file>`. Автоматически обновляет список загруженных файлов
          в хранилище;
        - `downloadHomework(fileHash)`: Асинхронно скачивает файл с сервера. Для указания файла используйте хэш, он
          доступен в списке загруженных файлов;

    - `userCourses.modules[n].resources.test.tools`:
        - `updateMeta()`: обновляет метаданные теста - номер попытки, последний задействованный вопрос, и так далее,
          если необходимо;
        - `launch()`: Запускает выполнение теста, до этого момента выгрузить вопросы с сервера невозможно;
        - `finish()`: Завершает выполнение теста, автоматически обновляет ревью, закрывает доступ к вопросам;
   ##### Особенности
    - Загружается и обновляется автоматически;
        - Учитывайте, что до загрузки свойства могут быть равны undefined или null;
        - Обращайтесь ко вложенным свойствам через `?.`, `val?.[index]?.attr`;
    - Для оптимизации трафика ветки объекта не будут загружены до первого обращения к ним;
    - При обращении к веткам объекта из кода в <script>, учитывайте его асинхронную природу;
        - Как пример, `userCourses[n].modules[m].name` будет работать только если ветка гарантированно прогружена!
        - `userCourses[n].modules[m].name.then(action)` будет работать в любом случае;
        - внутри <template> `userCourses[n].modules[m].name` будет работать в "синхронной манере" всегда;
    - Поле `performance` указано как целочисленное, чтобы, при вычислении средних баллов избежать ошибки
      float-исчислений;
    - Для вывода дробного балла достаточно будет разделить `performance` на 10. Тогда 76 баллов превратятся в 7.6 и тд;
    - Учтите, что поле `modules`->`resources`->`articles`->`completed` в контексте группы вычисляется динамически на
      основе значений этого поля в подчиненных элементах;

3. `unreadMessages` - список непрочитанных сообщений;
   ##### Структура состояния
   ```
   [
      {
        "course": "INT // Идентификатор курса, к которому относится сообщение",
        "module": "INT // Идентификатор модуля внутри курса",
        "type": "STRING // Тип сообщения, может быть 'deadline' для уведомлений о сроках или 'comment' для комментариев",
        "content": "MIXED // Содержание сообщения. Для 'deadline' типа это INT, показывающий количество дней до дедлайна (может быть отрицательным, если дедлайн пропущен). Для 'comment' типа это STRING с текстом комментария",
        "hash": "STRING // Уникальный хеш сообщения, используемый для идентификации и последующих операций, таких как пометка о прочтении",
        "watched": "WRITABLE BOOLEAN // Флаг, показывающий, было ли сообщение просмотрено. False, если сообщение не просмотрено"
      }
    ]
   ```
   ##### Особенности
    - Для исключения элементов из списка, поставьте свойство `watched` в значение `true` - это не уберет сообщение из
      списка здесь-и-сейчас, но предотвратит его загрузку в будущем;

4. `update`
   Не состояние. Метод, запускающий принудительное обновление всех состояний;

----

#### `WRITABLE BOOLEAN`

- Некоторые поля имеют тип `WRITABLE BOOLEAN` - это означает, что они работают не только на чтение, но и на запись;
- При этом локальное состояние поля будет автоматически отражено на сервер;

----

##### Использование

Для использования `CoursesStore` импортируйте его в ваш компонент Vue и просто обращайтесь к хранимым состояниям.

Пример:

```javascript
<script setup>
    import {useCoursesStore} from "@/stores/CoursesStore.js";
    const courseStore = useCoursesStore();
    <script>
        <template>
            <pre>{{courseStore?.availableCourses}}</pre>
            <pre>{{courseStore?.userCourses}}</pre>
        </template>
```